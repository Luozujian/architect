### kafka基础

#### 1. 什么是kafka？(2_2023_11_29)
kafka是一个分布式的基于发布/订阅分布式消息队列，常用用于大数据实时处理领域


#### 2. 使用消息队列的好处？(2_2023_11_29)
1. 解耦 => 消息生产方和消息消费方解耦，允许双方进行拓展或者修改数据处理过程，只需要遵循接口约束即可
2. 削峰 => 系统可能会瞬时流量非常大，系统无法处理，可以直接将消息丢消息队列，然后异步消费，达到一个削峰的效果
3. 异步通信 => 不希望在线处理非常耗时的任务，可以使用kafka让其离线处理

#### 3. kafka 核心概念？ (2_2023_11_30)
producer: 消息生成者
consumer: 消费者
broker: 起kafka的进程
topic: 主题，消息分类
partition: 分区，用于提升topic的负载能力
leader: 针对分区的leader, 还有follow
消费者组: 一个分区只能被一个消费者组中的一个消费者消费

#### 4. topic的数据是存储在磁盘还是内存？ (2_2023_11_30)
存储在磁盘，并且是以topic + 分区id来存储的

#### 5. 分区和副本可以放在同一个broker吗？ (2_2023_11_30)
分区和副本不能放在同一个broker, 也就是说副本数不能超过broker数量

#### 6. topic在磁盘中存储了什么？ (2_2023_11_30)
存储两种文件，.log文件，用来存储数据，.index文件，用来记录索引。.index文件以第一条记录的偏移量作为文件名，这样就可以通过二分算法得到数据在那个文件，然后通过偏移量
减去第一个偏移量，可以在o(1)时间内得到，数据在.log文件中的偏移量

#### 7. kafka 是拉还是推？  (2_2023_11_30)
kafka实现的是拉取模式，客户端实现一个长轮询


#### 8. 为什么要进行分区？ (2_2023_11_30)
1. 便于水平拓展
2. 提升并发能力，以partition为维度进行读写

#### 9. producer 发送数据的策略？ (2_2023_11_30)
1. 如果指明了partition, 则发送到指定的partition
2. 如果指定了key，则对key做个HASH，然后对partition数量取余
3. 如果啥都没指定，则在第一次发送数据的时候生成的随机数，然后对partition数量取模，后续每次+1，其实就是轮询

#### 10. 如何保证producer发送数据的可靠性？ (2_2023_11_30)
ack机制，向partition发送数据，partition收到数据之后，并且根据策略同步给flower节点之后，返回ack确认，客户端收到ack确认后，可继续发送

#### 11. 什么是ISR？ (2_2023_11_30)
与leader保持同步的flower, 如果ISR中的节点长时间未和master节点同步数据，则会被踢出ISR集合，当leader节点故障时，则从ISR里面选举新的leader节点

#### 12. 数据会丢失或者重复发送吗？ (2_2023_11_30)
重复发送: leader还未返回ack，但是已经同步给flower了，然后就挂掉了,然后再向新的节点发送就重复了
数据丢失: leader节点没有ISR，然后挂掉了

#### 13. broker返回ack的策略？ (2_2023_11_30)
1. leader和flower数据同步完成之后，再返回ack，延迟高，最多允许n - 1个节点故障
2. leader和半数节点同步完数据之后，再返回ack，延迟低，最多允许 n/2 - 1个节点故障，就至少要保证有一台flower拿到数据

#### 14. 加入到ISR的条件？  (2_2023_11_30)
1. flower如果10s没有和leader进行数据传递，则踢出ISR

#### 15. ack应答机制有几种？  (2_2023_11_30)
3种分别是:
0: producer不等待broker的ack，这一操作延迟最低，broker接收到消息后，还没写入到磁盘就返回了，当broker出现故障的时候，数据丢失
1: brocker leader partition落库后就返回，如果leader partition对应的brocker挂掉之后，就会出现数据丢失
-1: leader同步数据给所有flower后才返回ack，也可能存在数据丢失的情况

#### 16.   




