# 滑动窗口 & 拥塞避免算法


#### 1. 什么是TCP滑动窗口？ (2_2024_02_24)



1. 优化通信效率
最开始TCP的通信模式是Send-Await-Send的模式，发送方每发送一个报文都要等待接收方确认，如果迟迟没有收到确认报文，就会会重新发送，这种方式通信效率较低。

能否允许发送方一边发送报文，一边接受确认报文呢？这样效率显然更高，于是乎引入了滑动窗口机制，为每个包进行编号，允许发送方连续发送报文，接收方缓存提前到达的报文，
然后等待其所期望的报文，如果所期望报文迟迟未到达，则丢弃提前到达的报文。


2. 协调通信节奏
双方同学效率不一致，处理效率高的疯狂向另一端发送报文，另一端来不及处理，导致报文被丢弃，然后Server端不端重发，带宽资源被浪费。


#### 2. 滑动窗口由几个部分组成？ (2_2024_02_24)

![image](https://github.com/Luozujian/architect/assets/27532970/ca39f586-5b26-4174-bb57-eda37be8170b)

发送方把发送窗口分为四个部分:

1. 发送并且被确认的数据

这部分些数据表示已经发送成功并且已经被确认的数据，比如图中前31B的数据，这些数据已经在窗口外了，窗口内编号最低的报文被确认后，窗口就开始右移，从窗口中把已确认
的数据移除出去，同时编号低还没准备发送出去的数据变成待发送数据

2. 发送未确认

这部分数据已经发送出去了，但是还未被确认，窗口内的数据


3. 还没发送，准备好发送的数据

这部分数据表示接收方还有足够的缓存还接收这部分数据，应该立马被发送出去


4. 还没发送，并且还没准备好发送的数据
这部分数据尚未发送，并且还没准备好去发送，接收方没有空余位置去接受它



接收方把窗口分为三个部分:
1. 已接收&已确认但是还没别应用层取走的数据


2. 未发送，但可发送的数据
数据被取走整个窗口就右移

![image](https://github.com/Luozujian/architect/assets/27532970/fd139301-d446-463a-adde-2ba02071ea09)

3. 未发送，不可发送的数据

#### 3. 简述一下滑动窗口的原理？  (2_2024_02_24)
建立完TCP连接后，假设发送方有三个编号为1/2/3的报文要发送，如果接收方缓存大小允许，发送方会连续将三个报文发送过去，接收方接收到报文之后，
并不是对每一个报文都会响应一个确认报文，而是先对报文进行排序，然后整合成一个确认报文发送给发送方。


如果编号为1的报文，在网络中丢失了，而2，3到达了，会在接收方的缓冲区中缓存起来，而发送方迟迟没有收到接收方的确认报文，就会重新发送报文1，
服务端收到后，又重新会整合成一个确认报文发送给发送方，如果接收方迟迟未收到编号为1的报文，则会丢失提前到达的2和3号报文。

如此，发送窗口不断向右滑动，不断的发送数据

当接收方的窗口大小为0的时候，发送方就不能发送数据了


#### 4. 拥塞控制算法有几种？ (2_2024_02_24)

4种: 慢开始、拥塞避免、快重传和慢恢复

#### 5. 什么是慢开始？  (2_2024_02_24)

首先定一个阈值

TCP连接建立好之后，拥塞窗口会被定义为一个比较小的值，比如1，然后每次收到收到ack响应报文的时候，当拥塞窗口小于阈值的时候，塞用窗口的值就会翻倍，每次可发送数据为min(拥塞窗口，缓冲区大小)，

只要发生了报文超时重新发送，就会把拥塞窗口设置1，并且把阈值设置成原拥塞窗口的一半。


#### 6. 什么是拥塞避免？ (2_2024_02_24)

拥塞避免是用来控制拥塞窗口增长的速度的，当拥塞窗口大于阈值的时候，每次收到一个确认报文，只会把拥塞窗口 + 1，



#### 7. 什么是快重传？ (2_2024_02_24)
当发送方连续收到3个关于某个报文的确认报文，则立马传递该报文，而不是等报文过期。


![image](https://github.com/Luozujian/architect/assets/27532970/aa19687b-f904-4406-876d-7cdf33932aab)



#### 8. 什么是快恢复？  (2_2024_02_24)
与快重传配合使用，当连续收到三个重复的确认报文时，为了预防网络阻塞，于是会把阈值设置成原拥塞窗口的一半，然后把拥塞窗口设置成阈值，考虑到
如果网络阻塞就不会连续收到三个确认报文，所以直接开始拥塞避免算法，而不是重新执行慢开始算法。


![image](https://github.com/Luozujian/architect/assets/27532970/3cffa488-90ea-417b-afe7-259ba7c00d32)











