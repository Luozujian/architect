# tcp报文结构
![image](https://github.com/Luozujian/architect/assets/27532970/7ac7730f-e975-42d9-bd68-67650506d866)



#### 1. TCP报文结构？(3_2024_12_11)
第一列:
1. 源端口: 原计算机上应用程序的端口号，占16位
2. 目的端口: 目的计算机应用程序的端口号，占16位

第二列:
序列号: 占32位，他表示本报文所发送数据第一个字节的数据，在TCP连接中，每个字节都拥有一个序列号。当SYN不能于1时，其就是数据段的第一个编号，当SYN = 1时
这个时候这个字段的值就是初始化序列值(ISN)，用于对序列号进行同步，这时，第一个字节的序列号比这个字段大1，即ISN + 1

第三列:
确认号: TCP的确认号，占32位，他表示接收方期望收到发送方下一个报文的第一个字节数据的编号。确认序列号是上次已成功收到的最后一个数据字节序号+1，只有ACK标记为1时，才生效。


第四列:

报文头长度: 4位，1. TCP报文头长度，数据段的数据偏移量，数据偏移量指的是数据段存储数据开始部分距离数据段起始处的字节偏移量，用于告诉接收方数据从何处开始
保留字段: 4位，全部为0
8个标记位: 8位

1. URG(紧急): 只有当URG = 1时，表示该报文应该立即被发送，而不是按本来的次序发送，于紧急指针一起使用
2. ACK(确认): 只有当ACK = 1时，确认序号才生效
3. PSH(推送): 当PSH = 1时，接收方应该立即将报文传输给应用层
4. RST(复位): 当RST = 1时，表示连接出现问题，必须释放连接，然后重新建立传输连接
5. SYN(同步): ACK = 0，SYN = 1表示建立一个连接，携带SYN标志的为同步报文
6. FIN(关闭): FIN = 1表示发送方已经完成发送任务
7. CWR(减少拥塞窗口): 告诉接收放减少用塞窗口
8. ECE(标记网络阻塞)，告诉接收方，网络阻塞


窗口: 16位，TCP通过滑动窗口的概念来进行流量控制，其表示从ACK NUMBER开始其还能接受多个字节的数据量，也表示当前接受端的接受窗口还剩多少空间，假如发送方发送效率很高，而接收方
的接受速度却很低，这个时候就会造成数据丢失，为了协调双方通信节奏，引入了滑动窗口来进行流量控制，滑动窗口大小最多65535字节。

第五列: 

校验和: 16位，由发送方基于TCP头部和数据内容生成一个校验数值，然后接收方根据收到的TCP报文首部和数据内容也生成一个校验值，两者必须一致，如果不一致则丢弃。

紧急指针: 16位，只有当URG = 1时才生效，与序号字段中的值相加，表示最后一个紧急数据的序号

可选字段: 长度不固定，但是必须是4B的整数倍，最多表示60字节，固定头已经占用列20字节了，可选最多40字节











